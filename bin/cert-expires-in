#!/bin/bash

# eg.
# cert-expires-in example.com 30

DOMAIN="$1";
DAYS=$(expr "$2" + 0);
IN_X_DAYS=$(date -v "+${DAYS}d" +%Y-%m-%d)
NOT_AFTER=`echo | openssl s_client -connect "${DOMAIN}:443" -servername "${DOMAIN}" 2>/dev/null | openssl x509 -noout -dates | grep notAfter | sed -e 's#notAfter=##'`
EXPIRES=$(date -v"$NOT_AFTER" +%Y-%m-%d)

if [[ "$EXPIRES" < "$IN_X_DAYS" ]]; then
  echo True
else
  echo False
fi
